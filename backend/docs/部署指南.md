 # 项目部署指南（使用 screen 管理服务）

## 1. 服务器环境准备

### 1.1 操作系统要求
- 推荐使用 Ubuntu 18.04+ 或 CentOS 7+
- 确保服务器已安装 Python 3.8+

### 1.2 安装必要工具
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y python3-pip python3-venv git screen

# CentOS/RHEL
sudo yum update
sudo yum install -y python3-pip python3-venv git screen
```

## 2. 项目部署步骤

### 2.1 克隆项目代码
```bash
# 选择合适的目录，如 /opt
cd /opt
git clone <项目仓库地址>
cd <项目目录>
```

### 2.2 创建虚拟环境并安装依赖
```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate

# 安装项目依赖
pip install -r requirements.txt
```

### 2.3 配置项目
- 根据实际情况修改后端配置（如需）
- 确保数据库文件有读写权限

## 3. 使用 screen 启动服务器

### 3.1 创建 screen 会话
```bash
# 创建一个名为 "leave_system" 的 screen 会话
screen -S leave_system
```

### 3.2 启动后端服务
```bash
# 激活虚拟环境
source venv/bin/activate

# 进入 backend 目录
cd backend

# 启动 Flask 应用
python app.py
```

### 3.3 分离 screen 会话
按下快捷键 `Ctrl + A + D` 分离当前会话，服务将在后台继续运行。

### 3.4 查看和管理 screen 会话

#### 查看所有 screen 会话
```bash
screen -ls
```

#### 重新连接到会话
```bash
screen -r leave_system
```

#### 终止会话
```bash
# 先连接到会话，然后按 Ctrl + C 停止服务，再输入 exit 退出会话
screen -r leave_system
# 按 Ctrl + C 停止服务
exit
```

## 4. 验证部署
```bash
# 使用 curl 测试服务是否正常运行
curl http://localhost:5000
```

## 5. 常见问题处理

### 5.1 端口占用问题
- 修改 `app.py` 中的端口配置
- 或使用 `lsof -i :5000` 查看占用端口的进程，然后使用 `kill <PID>` 终止进程

### 5.2 权限问题
- 确保项目目录有正确的读写权限
- 避免使用 root 用户运行服务

### 5.3 screen 会话管理
- 忘记会话名称：使用 `screen -ls` 查看所有会话
- 会话无响应：使用 `screen -D -r leave_system` 强制重新连接

## 6. 扩展建议
- 考虑使用 Nginx 作为反向代理，处理静态资源和负载均衡
- 配置 SSL 证书，启用 HTTPS
- 设置自动化部署脚本，简化更新流程

---

**注意**：
- 请根据实际服务器环境调整命令和路径
- 首次部署前建议备份服务器数据
- 定期更新项目依赖和系统软件，确保安全性